<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Geospatial Distribution Map by saptarshighosh9</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Geospatial Distribution Map</h1>
      <h2 class="project-tagline">Developed with python and R</h2>
      <a href="https://github.com/saptarshighosh9/Geospatial_Distribution_Map" class="btn">View on GitHub</a>
      <a href="https://github.com/saptarshighosh9/Geospatial_Distribution_Map/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/saptarshighosh9/Geospatial_Distribution_Map/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
<a id="project-introduction" class="anchor" href="#project-introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project Introduction</h3>

<p>I was in awe with the Facebook Global Social Network Map created by Paul Butler:</p>

<p><img src="http://revolution-computing.typepad.com/.a/6a010534b1db25970b0147e0ae51b2970b-800wi" alt="abcd"></p>

<p>So i thought of trying my hand in R and hence started this small experiment of mine with this image in my mind.</p>

<hr>

<h2>
<a id="information-collection" class="anchor" href="#information-collection" aria-hidden="true"><span class="octicon octicon-link"></span></a>Information Collection</h2>

<p>Facebook provides an awesome Graph API , that allows to get information regrding your friend's DOB,location,hometown,relationship status and many more.
Check out the graph API here: <a href="https://developers.facebook.com/tools-and-support/">Facebook Developers Tool</a>
I particularly used python to query the Graph API to get hold of location detail of my facebook friends.</p>

<p>Start with importing all this necessary libraries</p>

<pre><code>import sys
import urllib
import urllib2
import time
import datetime
import json
import webbrowser
import csv
</code></pre>

<p>Facebook supports OAuth authentication.To get access to the facebook Graph API ,authentication is required.</p>

<pre><code>webbrowser.open("https://www.facebook.com/dialog/oauth?"
                    "response_type=token&amp;client_id=145634995501895&amp;"
                    "redirect_uri=http://developers.facebook.com/tools/"
                    "explorer/callback&amp;scope=user_birthday,user_friends,publish_actions"
                    ",read_stream")
</code></pre>

<p>Once authentication is done , we can proceed with the Facebook Graph Explorer to get an access token.This token will be used for every query that is made to the API.</p>

<pre><code> webbrowser.open("http://developers.facebook.com/tools/explorer")
</code></pre>

<p>Copy the access token to any local variable when asked </p>

<pre><code>ACCESS_TOKEN = raw_input("\nEnter the TOKEN string obtained from API explorer page: \n")
</code></pre>

<p>Now lets fetch some JSON data from the API.</p>

<pre><code>hometown=urllib2.urlopen(ACCESS_URL+'https://graph.facebook.comfields=friends.fields(hometown)&amp;access_token='+ACCESS_TOKEN)
</code></pre>

<p>Now we have the entire JSON info about mu facebook friend and their hometown.
Now we have to parse the JSON to get individual hometown.</p>

<pre><code>   count=1
   while(count&lt;numoffriends):    
        if 'hometown' in json.loads(datafile.read())['friends']['data'][k]:
            fhometown=json.loads(datafile.read())['friends']['data'][k]['hometown']['name']
            decode_address_to_coordinates(fhometown)          
        count=count+1
</code></pre>

<p>Now we have the string of the hometown of all my facobook friend ,lets find the co-ordinates using Google MAP API and put the data in a csv file.</p>

<pre><code>def decode_address_to_coordinates(address):
        params = {
                'address' : address,
                'sensor' : 'true',
        }  
        url = 'http://maps.google.com/maps/api/geocode/json?' + urllib.urlencode(params)
        response = urllib2.urlopen(url)
        result = json.load(response)
        log=result['results'][0]['geometry']['location']['lng']
        lat=result['results'][0]['geometry']['location']['lat']

        p='%f,%f'%(log,lat)
        myfile=open("data.csv", "a")
        myfile.write(p + "\n")
</code></pre>

<p>Now atlast we have the co-oridnate details of all my friends.</p>

<h2>
<a id="drawing-the-map-with-r" class="anchor" href="#drawing-the-map-with-r" aria-hidden="true"><span class="octicon octicon-link"></span></a>Drawing the Map with R</h2>

<p>Lets first install all the required packages,</p>

<pre><code>library(ggmap)
library(geosphere)
library(maps)
library(ggplot2)
</code></pre>

<p>To install any package in R type ,</p>

<pre><code>package.install(packagename)
</code></pre>

<p>Now lets get the map template.</p>

<pre><code>world = map_data("world")
basemap = ggplot(legend = FALSE) + geom_polygon(data = world, aes(x = long,y = lat, group = group, fill = group)) + theme(legend.position = "none")
basemap = basemap + theme(panel.background = element_rect(fill = "#000000"),panel.grid.major = element_blank(), panel.grid.minor = element_blank())
</code></pre>

<p>Now plotting individual data point in the Map</p>

<pre><code>for(n in 0:numrowsindatafile)
{
p &lt;- read.csv("data.csv",skip=n,nrows=1,header = FALSE)
d &lt;- data.frame(lon=p$V1,lat=p$V2)
inter = as.data.frame(gcIntermediate(d, c(LATITUDE_OF_YOUR_OWN_HOMETOWN,LONGITUDE_OF_YOUR_OWN_HOMETOWN),n = 50, addStartEnd = TRUE))
names(inter) = c('lon', 'lat')
basemap = basemap + geom_line(data = inter, aes(x = lon, y = lat), color = "blue")
}
</code></pre>

<p>Now draw the final map</p>

<pre><code>basemap
</code></pre>

<p>This is final image i got</p>

<p><img src="https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xta1/v/t1.0-9/10409295_781710128546868_6332480672589065187_n.jpg?oh=55ff73ff2d6e8dffbb4bcdc8766b7fb1&amp;oe=5598B36C&amp;__gda__=1436251621_f8073be949039f03b655878b503d7b16" alt="Facebook Graph API"></p>

<h2>
<a id="note" class="anchor" href="#note" aria-hidden="true"><span class="octicon octicon-link"></span></a>Note:</h2>

<p>Graph API has undergone multiple version changes and the python code need modification to get access to the API.</p>

<h1>
<a id="contact" class="anchor" href="#contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contact:</h1>

<p>Drop me a mail at <a href="mailto:saptarshi.ghosh9@gmail.com">saptarshi.ghosh9@gmail.com</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/saptarshighosh9/Geospatial_Distribution_Map">Geospatial Distribution Map</a> is maintained by <a href="https://github.com/saptarshighosh9">saptarshighosh9</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

