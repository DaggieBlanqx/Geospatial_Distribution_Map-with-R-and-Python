{"name":"Geospatial Distribution Map","tagline":"Developed with Python and R","body":"### Project Introduction\r\nI was in awe with the Facebook Global Social Network Map created by Paul Butler.\r\nSo i thought of exprimenting with R and Python and hence started this small experiment of mine with this image in my mind.\r\n\r\n![abcd](http://revolution-computing.typepad.com/.a/6a010534b1db25970b0147e0ae51b2970b-800wi)\r\n\r\n***\r\n## Information Collection\r\nFacebook provides an awesome Graph API , that allows to get information regrding your friend's DOB,location,hometown,relationship status and many more.\r\nCheck out the graph API here: [Facebook Developers Tool](https://developers.facebook.com/tools-and-support/)\r\nI particularly used python to query the Graph API to get hold of location detail of my facebook friends.\r\n\r\nStart with importing all this necessary libraries\r\n```\r\nimport sys\r\nimport urllib\r\nimport urllib2\r\nimport time\r\nimport datetime\r\nimport json\r\nimport webbrowser\r\nimport csv\r\n```\r\n\r\nFacebook supports OAuth authentication.To get access to the facebook Graph API ,authentication is required.\r\n\r\n```\r\nwebbrowser.open(\"https://www.facebook.com/dialog/oauth?\"\r\n                    \"response_type=token&client_id=145634995501895&\"\r\n                    \"redirect_uri=http://developers.facebook.com/tools/\"\r\n                    \"explorer/callback&scope=user_birthday,user_friends,publish_actions\"\r\n                    \",read_stream\")\r\n```\r\n\r\nOnce authentication is done , we can proceed with the Facebook Graph Explorer to get an access token.This token will be used for every query that is made to the API.\r\n\r\n```\r\n webbrowser.open(\"http://developers.facebook.com/tools/explorer\")\r\n```\r\n\r\nCopy the access token to any local variable when asked \r\n```\r\nACCESS_TOKEN = raw_input(\"\\nEnter the TOKEN string obtained from API explorer page: \\n\")\r\n```\r\nNow lets fetch some JSON data from the API.\r\n\r\n```\r\nhometown=urllib2.urlopen(ACCESS_URL+'https://graph.facebook.comfields=friends.fields(hometown)&access_token='+ACCESS_TOKEN)\r\n```\r\nNow we have the entire JSON info about my facebook friend's hometown.\r\nNow we have to parse the JSON to get individual hometown.\r\n\r\n```\r\n   count=1\r\n   while(count<numoffriends):    \r\n        if 'hometown' in json.loads(datafile.read())['friends']['data'][k]:\r\n            fhometown=json.loads(datafile.read())['friends']['data'][k]['hometown']['name']\r\n            decode_address_to_coordinates(fhometown)          \r\n        count=count+1\r\n```\r\n\r\nNow we have the string of the hometown of all my facobook friend ,lets find the co-ordinates using Google MAP API and put the data in a csv file.\r\n\r\n```\r\ndef decode_address_to_coordinates(address):\r\n        params = {\r\n                'address' : address,\r\n                'sensor' : 'true',\r\n        }  \r\n        url = 'http://maps.google.com/maps/api/geocode/json?' + urllib.urlencode(params)\r\n        response = urllib2.urlopen(url)\r\n        result = json.load(response)\r\n        log=result['results'][0]['geometry']['location']['lng']\r\n        lat=result['results'][0]['geometry']['location']['lat']\r\n        \r\n        p='%f,%f'%(log,lat)\r\n        myfile=open(\"data.csv\", \"a\")\r\n        myfile.write(p + \"\\n\")\r\n```\r\n\r\nNow atlast we have the co-oridnate details of all my friends.\r\n\r\n\r\n## Drawing the Map with R\r\n\r\nLets first install all the required packages,\r\n\r\n```\r\nlibrary(ggmap)\r\nlibrary(geosphere)\r\nlibrary(maps)\r\nlibrary(ggplot2)\r\n```\r\n\r\nTo install any package in R type ,\r\n```\r\npackage.install(packagename)\r\n```\r\n\r\nNow lets get the map template.\r\n\r\n```\r\nworld = map_data(\"world\")\r\nbasemap = ggplot(legend = FALSE) + geom_polygon(data = world, aes(x = long,y = lat, group = group, fill = group)) + theme(legend.position = \"none\")\r\nbasemap = basemap + theme(panel.background = element_rect(fill = \"#000000\"),panel.grid.major = element_blank(), panel.grid.minor = element_blank())\r\n```\r\n\r\nNow plotting individual data point in the Map\r\n```\r\nfor(n in 0:numrowsindatafile)\r\n{\r\np <- read.csv(\"data.csv\",skip=n,nrows=1,header = FALSE)\r\nd <- data.frame(lon=p$V1,lat=p$V2)\r\ninter = as.data.frame(gcIntermediate(d, c(LATITUDE_OF_YOUR_OWN_HOMETOWN,LONGITUDE_OF_YOUR_OWN_HOMETOWN),n = 50, addStartEnd = TRUE))\r\nnames(inter) = c('lon', 'lat')\r\nbasemap = basemap + geom_line(data = inter, aes(x = lon, y = lat), color = \"blue\")\r\n}\r\n```\r\n\r\nNow draw the final map\r\n```\r\nbasemap\r\n```\r\n\r\nThis is final image i got\r\n\r\n![Facebook Graph API](https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xta1/v/t1.0-9/10409295_781710128546868_6332480672589065187_n.jpg?oh=55ff73ff2d6e8dffbb4bcdc8766b7fb1&oe=5598B36C&__gda__=1436251621_f8073be949039f03b655878b503d7b16)\r\n\r\n## Note:\r\nGraph API has undergone multiple version changes and the python code need modification to get access to the API.\r\n\r\n#Contact:\r\nDrop me a mail at saptarshi.ghosh9@gmail.com","google":"UA-61794858-2","note":"Don't delete this file! It's used internally to help with page regeneration."}